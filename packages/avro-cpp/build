#!/bin/bash

# required to get access to boost headers:
. /opt/mesosphere/active/mesos-buildenv/activate

export CPPFLAGS=-I/opt/mesosphere/include
export LDFLAGS="-L/opt/mesosphere/lib -Wl,-rpath=/opt/mesosphere/lib"
export LD_LIBRARY_PATH=/opt/mesosphere/lib

pushd /pkg/src/avro-cpp
mkdir -p build
pushd build

# configure build with cmake
# see https://cmake.org/cmake/help/v3.0/module/FindBoost.html
cmake \
  -DCMAKE_BUILD_TYPE=Release \
  -DCMAKE_INSTALL_PREFIX=$PKG_PATH \
  -DBOOST_ROOT=/opt/mesosphere/ \
  ..

# build/unittest
make -j8
make test
# install lib to $PKG_PATH/...
make install

popd
popd
