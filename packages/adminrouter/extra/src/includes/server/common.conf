# Group: Metadata
# Description: DC/OS version (unauthenticated)
location /dcos-metadata/dcos-version.json {
    # Allow non-authed access for the UI.
    alias /opt/mesosphere/active/dcos-metadata/etc/dcos-version.json;
}

## Error pages:
# BUG(prozlach): There may be a use-case when 401 is not generated by Lua call
# to util.exit_by_code() but by NGINX itself. In such a case we will need to
# create a separate location for this error page and emit correct
# `WWW-Authenticate` header. Until such use-case is found, I am leaning towards
# keeping things simple and re-using the same error page for both Lua code and
# the plain Nginx error page configuration.
error_page 401 /401.html;
# BUG(prozlach): 403 emitted by NGINX may not neccesarily be related to the
# lack of permissions related to DC/OS Authentication Token handling but to the
# NGINX access controls itself (e.g. accessing file to which Nginx process has
# no permissions to). Until such a use-case is found, I am leaning towards
# re-using error page here and keeping things simple (i.e. avoiding having two
# different error pages).
error_page 403 /403.html;
error_page 404 /404.html;
error_page 500 /500.html;
error_page 501 /501.html;
error_page 502 /502.html;
error_page 503 /503.html;
error_page 504 /504.html;

# This is a hybrid approach - the typical error pages are served from plain
# HTML files, special cases (i.e. errors emited by Lua code) are handled by
# util.exit_by_code() function.
location ~ "^/([4-5][0-1][0-9]).html" {
    charset "UTF-8";
    root /opt/mesosphere/active/adminrouter/extra/src/errorpages/;
    internal;
}
