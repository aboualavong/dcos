ngindox: 0.1.0
backends:
  certificate_authority:
    server: '127.0.0.1:8888'
  dcos_history_service:
    server: 'leader.mesos:15055'
  dddt:
    server: 'unix:/run/dcos/3dt.sock'
  exhibitor:
    server: '127.0.0.1:8181'
  iam:
    server: '127.0.0.1:8101'
  log:
    server: 'unix:/run/dcos/dcos-log.sock'
  mesos_dns:
    server: '127.0.0.1:8123'
  metrics:
    server: 'unix:/run/dcos/dcos-metrics-master.sock'
  navstar:
    server: '127.0.0.1:62080'
  pkgpanda:
    server: 'unix:/run/dcos/pkgpanda-api.sock'
  vault_default:
    server: '127.0.0.1:8200'
routes:
  /:
    group: Other
    matcher: path
    file: /opt/mesosphere/active/dcos-ui/usr
    path: /
  '/(slave|agent)/(?<agentid>[0-9a-zA-Z-]+)':
    group: Other
    matcher: regex
    rewrites:
      - regex: ^/(slave|agent)/(.*)$
        replacement: /agent/$2/
        type: last
    path: '/(slave|agent)/(?<agentid>[0-9a-zA-Z-]+)'
  '/(slave|agent)/(?<agentid>[0-9a-zA-Z-]+)(?<url>.+)':
    group: Other
    matcher: regex
    proxy:
      path: '$agentaddr:$agentport'
    rewrites:
      - regex: '^/(slave|agent)/[0-9a-zA-Z-]+/.*$'
        replacement: $url
        type: break
    path: '/(slave|agent)/(?<agentid>[0-9a-zA-Z-]+)(?<url>.+)'
  /acs/acl-schema.json:
    group: Other
    matcher: exact
    file: /opt/mesosphere/active/acl-schema/etc/acl-schema.json
    path: /acs/acl-schema.json
  /acs/api/v1:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend/acs/api/v1'
      backend: iam
    path: /acs/api/v1
  /acs/api/v1/auth/(login|logout|jwks|providers|oidc/callback|oidc/providers/?|saml/providers/?):
    group: Other
    matcher: regex
    proxy:
      path: >-
        http://$backend~
        ^/acs/api/v1/auth/(login|logout|jwks|providers|oidc/callback|oidc/providers/?|saml/providers/?)$
      backend: iam
    path: >-
      /acs/api/v1/auth/(login|logout|jwks|providers|oidc/callback|oidc/providers/?|saml/providers/?)
  '/acs/api/v1/auth/saml/providers/[0-9a-zA-Z-]+/acs-callback':
    group: Other
    matcher: regex
    proxy:
      path: >-
        http://$backend~
        ^/acs/api/v1/auth/saml/providers/[0-9a-zA-Z-]+/acs-callback$
      backend: iam
    path: '/acs/api/v1/auth/saml/providers/[0-9a-zA-Z-]+/acs-callback'
  /acs/api/v1/users/(?<uid_path>.*)/permissions:
    group: Other
    matcher: regex
    proxy:
      path: 'http://$backend~ ^/acs/api/v1/users/(?<uid_path>.*)/permissions$'
      backend: iam
    path: /acs/api/v1/users/(?<uid_path>.*)/permissions
  /ca/api/v2/(newcert|newkey|sign):
    group: Other
    matcher: regex
    proxy:
      path: 'http://$backend~ /ca/api/v2/(newcert|newkey|sign)$'
      backend: certificate_authority
    path: /ca/api/v2/(newcert|newkey|sign)
  /ca/api/v2/certificates:
    group: Other
    matcher: exact
    proxy:
      path: 'http://$backend= /ca/api/v2/certificates'
      backend: certificate_authority
    path: /ca/api/v2/certificates
  /ca/api/v2/info:
    group: Other
    matcher: exact
    proxy:
      path: 'http://$backend= /ca/api/v2/info'
      backend: certificate_authority
    path: /ca/api/v2/info
  /ca/cacerts.jks:
    group: Other
    matcher: exact
    file: /run/dcos/pki/CA/certs/cacerts.jks
    path: /ca/cacerts.jks
  /ca/dcos-ca.crt:
    group: Other
    matcher: exact
    file: /run/dcos/pki/CA/certs/ca.crt
    path: /ca/dcos-ca.crt
  /capabilities:
    group: Other
    matcher: path
    proxy:
      path: $upstream_cosmos
    path: /capabilities
  /cosmos/service/:
    group: Other
    matcher: path
    proxy:
      path: $upstream_cosmos
    rewrites:
      - regex: ^/cosmos/(.*)
        replacement: /$1
        type: break
    path: /cosmos/service/
  /dcos-history-service/:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend/'
      backend: dcos_history_service
    path: /dcos-history-service/
  /dcos-metadata/bootstrap-config.json:
    group: Other
    matcher: path
    file: /opt/mesosphere/etc/bootstrap-config.json
    path: /dcos-metadata/bootstrap-config.json
  /dcos-metadata/dcos-version.json:
    group: Other
    matcher: path
    file: /opt/mesosphere/active/dcos-metadata/etc/dcos-version.json
    path: /dcos-metadata/dcos-version.json
  /dcos-metadata/ui-config.json:
    group: Other
    matcher: path
    file: /opt/mesosphere/etc/ui-config.json
    path: /dcos-metadata/ui-config.json
  /exhibitor:
    group: Other
    matcher: exact
    redirects:
      - regex: ^/exhibitor$
        replacement: '$scheme://$http_host/exhibitor/'
        type: permanent
    path: /exhibitor
  /exhibitor/:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend/'
      backend: exhibitor
    path: /exhibitor/
  /exhibitor/exhibitor/v1/cluster/status:
    group: Other
    matcher: exact
    proxy:
      path: 'http://$backend= /exhibitor/exhibitor/v1/cluster/status'
      backend: exhibitor
    rewrites:
      - regex: ^/exhibitor/(.*)
        replacement: /$1
        type: break
    path: /exhibitor/exhibitor/v1/cluster/status
  /internal/acs/api/v1/internal/policyquery:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend/internal/acs/api/v1/internal/policyquery'
      backend: iam
    rewrites:
      - regex: ^/internal/(.*)
        replacement: /$1
        type: break
    path: /internal/acs/api/v1/internal/policyquery
  /marathon:
    group: Other
    matcher: exact
    rewrites:
      - regex: ^/marathon$
        replacement: '$scheme://$http_host/marathon/'
        type: last
    path: /marathon
  /marathon/:
    group: Other
    matcher: path
    rewrites:
      - regex: ^/marathon/(.*)$
        replacement: /service/marathon/$1
        type: last
    path: /marathon/
  /mesos:
    group: Other
    matcher: exact
    redirects:
      - regex: ^/mesos$
        replacement: '$scheme://$http_host/mesos/'
        type: permanent
    path: /mesos
  /mesos/:
    group: Other
    matcher: path
    proxy:
      path: $upstream_mesos
    rewrites:
      - regex: ^/mesos/(.*)
        replacement: /$1
        type: break
    path: /mesos/
  /mesos_dns:
    group: Other
    matcher: exact
    redirects:
      - regex: ^/mesos_dns$
        replacement: '$scheme://$http_host/mesos_dns/'
        type: permanent
    path: /mesos_dns
  /mesos_dns/:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend/'
      backend: mesos_dns
    path: /mesos_dns/
  /metadata:
    group: Other
    matcher: path
    lua:
      file: conf/master/metadata.lua
    path: /metadata
  /navstar/lashup/key:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend/lashup/key'
      backend: navstar
    path: /navstar/lashup/key
  /networking/api/v1/:
    group: Other
    matcher: path
    proxy:
      path: $upstream_networking_api
    rewrites:
      - regex: ^/networking/api/v1/(.*)
        replacement: /$1
        type: break
    path: /networking/api/v1/
  /package/:
    group: Other
    matcher: path
    proxy:
      path: $upstream_cosmos
    path: /package/
  /pkgpanda/:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend'
      backend: pkgpanda
    path: /pkgpanda/
  /pkgpanda/active.buildinfo.full.json:
    group: Other
    matcher: path
    file: /opt/mesosphere/active.buildinfo.full.json
    path: /pkgpanda/active.buildinfo.full.json
  /secrets/v1/:
    group: Other
    matcher: path
    proxy:
      path: $upstream_secrets
    path: /secrets/v1/
  '/service/(?<serviceid>[0-9a-zA-Z-.]+)':
    group: Other
    matcher: regex
    redirects:
      - regex: ^/service/(.*)$
        replacement: /service/$1/
        type: permanent
    path: '/service/(?<serviceid>[0-9a-zA-Z-.]+)'
  '/service/(?<serviceid>[0-9a-zA-Z-.]+)/(?<url>.*)':
    group: Other
    matcher: regex
    proxy:
      path: $serviceurl
    rewrites:
      - regex: '^/service/[0-9a-zA-Z-.]+/?.*$'
        replacement: /$url
        type: break
    path: '/service/(?<serviceid>[0-9a-zA-Z-.]+)/(?<url>.*)'
  /system/health/v1:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend'
      backend: dddt
    path: /system/health/v1
  '/system/v1/agent/(?<agentid>[0-9a-zA-Z-]+)(?<type>(/logs/v1|/metrics/v0))(?<url>.*)':
    group: Other
    matcher: regex
    proxy:
      path: >-
        $agentaddr:$adminrouter_agent_port/system/v1$type$url$is_args$query_string
    rewrites:
      - regex: '^/agent/[0-9a-zA-Z-]+(.*)$'
        replacement: $1
        type: break
    path: >-
      /system/v1/agent/(?<agentid>[0-9a-zA-Z-]+)(?<type>(/logs/v1|/metrics/v0))(?<url>.*)
  /system/v1/leader/marathon(?<url>.*):
    group: Other
    matcher: regex
    proxy:
      path: $mleader_host/system/v1$url$is_args$query_string
    path: /system/v1/leader/marathon(?<url>.*)
  /system/v1/leader/mesos(?<url>.*):
    group: Other
    matcher: regex
    proxy:
      path: 'http://leader.mesos/system/v1$url$is_args$query_string'
    path: /system/v1/leader/mesos(?<url>.*)
  /system/v1/logs/v1/:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend'
      backend: log
    path: /system/v1/logs/v1/
  /system/v1/metrics/:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend'
      backend: metrics
    path: /system/v1/metrics/
  /vault/default/:
    group: Other
    matcher: path
    proxy:
      path: 'http://$backend/'
      backend: vault_default
    path: /vault/default/
