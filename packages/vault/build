#!/bin/bash

mkdir -p $PKG_PATH/bin
mkdir -pv /pkg/src/github.com/hashicorp/
mv /pkg/src/vault /pkg/src/github.com/hashicorp/
cd /pkg/src/github.com/hashicorp/vault
CGO_ENABLED=0 go build --ldflags '-extldflags " -static"' -o $PKG_PATH/bin/vault github.com/hashicorp/vault

vault_service="$PKG_PATH/dcos.target.wants_master/dcos-vault.service"
mkdir -p $(dirname "$vault_service")

cp /pkg/extra/dcos-vault.service "$vault_service"
